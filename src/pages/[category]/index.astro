---
import DocsLayout from "@/layouts/DocsLayout.astro"
import { getCollection } from "astro:content"
import { CATEGORIES, type Category } from "@/lib/categories"

export async function getStaticPaths() {
  return CATEGORIES.map((category) => ({ params: { category } }))
}

const { params } = Astro
const category = params.category as Category
const items = await getCollection(category)
---

<DocsLayout title={category?.toUpperCase()}>
  <ul class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
    {
      items
        .sort((a, b) => a.data.order - b.data.order)
        .map(({ data, slug }) => (
          <li>
            <a href={`/${category}/${slug}`} class="card block overflow-hidden">
              {data.cover?.src && (
                <img
                  src={data.cover.src}
                  alt={data.cover.alt}
                  class="w-full aspect-[4/3] object-cover"
                />
              )}
              <div class="p-4">
                <div class="text-xs text-[--color-ink-muted] mb-1">
                  {category}
                </div>
                <h2 class="hl-title text-xl">{data.title}</h2>
                {data.excerpt && (
                  <p class="mt-2 text-sm opacity-80 line-clamp-3">
                    {data.excerpt}
                  </p>
                )}
                {data.tags?.length > 0 && (
                  <div class="mt-3 flex flex-wrap gap-2">
                    {data.tags.map((t) => (
                      <span class="text-xs px-2 py-1 rounded-full border border-[--color-border]">
                        {t}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          </li>
        ))
    }
  </ul>
</DocsLayout>
